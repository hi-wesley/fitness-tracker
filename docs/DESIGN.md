# Design Doc — Wellness Aggregator

## Goals
- Unify disparate health data streams (sleep, nutrition, activity, vitals) into a single, daily view.
- Present a dashboard that makes recent history easy to scan and compare across categories.
- Generate actionable, personalized insights via GPT-5.2 (server-side).

## Non-goals (for the prototype phase)
- Direct integrations with HealthKit / Google Fit / MyFitnessPal APIs.
- User accounts, sync, or cloud storage.
- Clinical-grade or diagnostic recommendations.

## Tech stack
- Frontend: plain HTML/CSS/JS (static; Vercel-friendly)
- Backend: Node/Express (Hetzner-friendly)
- Insights: OpenAI API (GPT-5.2) via backend (WIP)

## Data model (canonical JSON)
The prototype accepts a canonical JSON payload that can represent many “source” systems.

Top-level:
- `schemaVersion`: number (currently `1`)
- `user`: optional object, supports `tz` (IANA time zone)
- `records`: array of records from any sources

Record shapes:
- Point-in-time record:
  - `type`: string (e.g. `nutrition`, `weight`, `resting_heart_rate`, `steps`, `blood_pressure`)
  - `timestamp`: ISO string
  - `data`: object with type-specific fields
  - `source`: string
- Interval record:
  - `type`: string (e.g. `sleep_session`, `workout`)
  - `start`: ISO string
  - `end`: ISO string
  - `data`: object with type-specific fields
  - `source`: string

Supported record `type`s in this prototype:
- `sleep_session`: `data.quality` (optional), duration derived from `start`/`end`
- `nutrition`: `data.calories`, `data.carbs_g`, `data.protein_g`, `data.fat_g`, `data.sugar_g`
- `steps`: `data.count`
- `workout`: `data.duration_min` (optional), `data.calories` (optional), `data.intensity` (`easy|moderate|hard`)
- `resting_heart_rate`: `data.bpm`
- `weight`: `data.kg`
- `blood_pressure`: `data.systolic`, `data.diastolic`, `data.unit`

Sample dataset:
- `data/sample-health-data.json`

## Daily unification logic
The app normalizes all records into a daily rollup series.

- Time zone:
  - uses `user.tz` if present + valid, otherwise uses the browser’s time zone (fallback: `America/Los_Angeles`)
- Day assignment:
  - `sleep_session`: assigned to the *wake day* (based on `end`)
  - `workout`: assigned to the *start day* (based on `start`)
  - all other records: assigned by `timestamp`
- Aggregations:
  - sleep: sum durations, average quality
  - nutrition: sum daily totals (Calories + macros)
  - steps: sum
  - workouts: sum minutes + calories; compute `workout_load = minutes * intensityFactor`
  - weight/blood pressure: use latest reading of the day
  - resting HR: daily average (supports multiple readings)

## Insights engine
Insights will be generated by GPT-5.2 in the backend (not implemented yet). The frontend includes an insights layout (overall summary + one card per category) ready to be populated by server output.

## UI/UX
- Import via paste or file upload.
- Sample dataset auto-loads on startup for easy demos.
- Dashboard as a 2×3 grid:
  - Sleep (1/7/30)
  - Physiological stress (1/7/14; previous day)
  - Exercise (1/7/30)
  - Nutrition (1/7/30)
  - Blood pressure (7/14/30)
  - Weight (7/30/90)
- Hover tooltips on charts for quick inspection.

## Future enhancements
- Data ingestion:
  - connectors + ETL adapters for HealthKit/Google Fit/MyFitnessPal exports
  - schema versioning + validation UI
- Better modeling:
  - per-user baselines by weekday and training phase
  - structured LLM prompts + evaluation harness for safe health insights
- Productization:
  - accounts + persistence
  - scheduled re-analysis + notifications
  - privacy controls + encryption
